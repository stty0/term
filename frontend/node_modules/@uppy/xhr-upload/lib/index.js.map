{"version":3,"names":["BasePlugin","EventManager","RateLimitedQueue","internalRateLimitedQueue","NetworkError","isNetworkError","fetcher","filterNonFailedFiles","filterFilesToEmitUploadStarted","packageJson","locale","buildResponseError","xhr","err","error","Error","Object","assign","data","request","setTypeInBlob","file","dataWithUpdatedType","slice","size","meta","type","defaultOptions","formData","fieldName","method","allowedMetaFields","responseUrlFieldName","bundle","headers","timeout","limit","withCredentials","responseType","getResponseData","responseText","parsedResponse","JSON","parse","getResponseError","_","response","validateStatus","status","_getFetcher","_classPrivateFieldLooseKey","_uploadLocalFile","_uploadBundle","_getCompanionClientArgs","_uploadFiles","_handleUpload","XHRUpload","constructor","uppy","opts","defineProperty","value","_uploadFiles2","_getCompanionClientArgs2","_uploadBundle2","_uploadLocalFile2","writable","fileIDs","length","log","files","getFilesByIds","filesFiltered","filesToEmit","emit","isSomeFileRemote","some","isRemote","TypeError","_classPrivateFieldLooseBase","id","defaultLocale","i18nInit","requests","undefined","uploaderEvents","create","url","options","_options$method","res","toUpperCase","onTimeout","seconds","Math","ceil","i18n","onUploadProgress","event","lengthComputable","uploader","bytesUploaded","loaded","total","bytesTotal","statusText","body","uploadURL","name","customError","getOptions","overrides","getState","xhrUpload","addMetadata","Array","isArray","keys","forEach","item","subItem","append","createFormDataUpload","formPost","FormData","createBundledUpload","install","capabilities","setState","individualCancellation","addUploader","uninstall","removeUploader","events","controller","AbortController","uppyFetch","wrapPromiseFunction","fetch","endpoint","signal","onFileRemove","abort","onCancelAll","_ref","reason","abortOn","message","remove","_this$uppy$getState$x","optsFromState","once","off","_file$remote","remote","protocol","fieldname","metadata","fromEntries","map","httpMethod","useFormData","Promise","allSettled","getQueue","removedHandler","removedFile","on","uploadPromise","getRequestClientForFile","uploadRemoteFile","wrapSyncFunction","priority","VERSION","version"],"sources":["index.ts"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport type { DefinePluginOpts, PluginOpts } from '@uppy/core/lib/BasePlugin.js'\nimport type { RequestClient } from '@uppy/companion-client'\nimport EventManager from '@uppy/core/lib/EventManager.js'\nimport {\n  RateLimitedQueue,\n  internalRateLimitedQueue,\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore untyped\n} from '@uppy/utils/lib/RateLimitedQueue'\nimport NetworkError from '@uppy/utils/lib/NetworkError'\nimport isNetworkError from '@uppy/utils/lib/isNetworkError'\nimport { fetcher } from '@uppy/utils/lib/fetcher'\nimport {\n  filterNonFailedFiles,\n  filterFilesToEmitUploadStarted,\n} from '@uppy/utils/lib/fileFilters'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport type { Meta, Body, UppyFile } from '@uppy/utils/lib/UppyFile'\nimport type { State, Uppy } from '@uppy/core'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.ts'\n\ndeclare module '@uppy/utils/lib/UppyFile' {\n  // eslint-disable-next-line no-shadow, @typescript-eslint/no-unused-vars\n  export interface UppyFile<M extends Meta, B extends Body> {\n    // TODO: figure out what else is in this type\n    xhrUpload?: { headers: Record<string, string> }\n  }\n}\n\ndeclare module '@uppy/core' {\n  // eslint-disable-next-line no-shadow, @typescript-eslint/no-unused-vars\n  export interface State<M extends Meta, B extends Body> {\n    // TODO: figure out what else is in this type\n    xhrUpload?: { headers: Record<string, string> }\n  }\n}\n\nexport interface XhrUploadOpts<M extends Meta, B extends Body>\n  extends PluginOpts {\n  endpoint: string\n  method?:\n    | 'GET'\n    | 'HEAD'\n    | 'POST'\n    | 'PUT'\n    | 'DELETE'\n    | 'OPTIONS'\n    | 'PATCH'\n    | 'delete'\n    | 'get'\n    | 'head'\n    | 'options'\n    | 'post'\n    | 'put'\n    | string\n  formData?: boolean\n  fieldName?: string\n  headers?:\n    | Record<string, string>\n    | ((file: UppyFile<M, B>) => Record<string, string>)\n  timeout?: number\n  limit?: number\n  responseType?: XMLHttpRequestResponseType\n  withCredentials?: boolean\n  validateStatus?: (\n    status: number,\n    body: string,\n    xhr: XMLHttpRequest,\n  ) => boolean\n  getResponseData?: (body: string, xhr: XMLHttpRequest) => B\n  getResponseError?: (body: string, xhr: XMLHttpRequest) => Error | NetworkError\n  allowedMetaFields?: string[] | null\n  bundle?: boolean\n  responseUrlFieldName?: string\n}\n\nfunction buildResponseError(\n  xhr: XMLHttpRequest,\n  err?: string | Error | NetworkError,\n) {\n  let error = err\n  // No error message\n  if (!error) error = new Error('Upload error')\n  // Got an error message string\n  if (typeof error === 'string') error = new Error(error)\n  // Got something else\n  if (!(error instanceof Error)) {\n    error = Object.assign(new Error('Upload error'), { data: error })\n  }\n\n  if (isNetworkError(xhr)) {\n    error = new NetworkError(error, xhr)\n    return error\n  }\n\n  // @ts-expect-error request can only be set on NetworkError\n  // but we use NetworkError to distinguish between errors.\n  error.request = xhr\n  return error\n}\n\n/**\n * Set `data.type` in the blob to `file.meta.type`,\n * because we might have detected a more accurate file type in Uppy\n * https://stackoverflow.com/a/50875615\n */\nfunction setTypeInBlob<M extends Meta, B extends Body>(file: UppyFile<M, B>) {\n  const dataWithUpdatedType = file.data.slice(0, file.data.size, file.meta.type)\n  return dataWithUpdatedType\n}\n\nconst defaultOptions = {\n  formData: true,\n  fieldName: 'file',\n  method: 'post',\n  allowedMetaFields: null,\n  responseUrlFieldName: 'url',\n  bundle: false,\n  headers: {},\n  timeout: 30 * 1000,\n  limit: 5,\n  withCredentials: false,\n  responseType: '',\n  getResponseData(responseText) {\n    let parsedResponse = {}\n    try {\n      parsedResponse = JSON.parse(responseText)\n    } catch {\n      // ignore\n    }\n    // We don't have access to the B (Body) generic here\n    // so we have to cast it to any. The user facing types\n    // remain correct, this is only to please the merging of default options.\n    return parsedResponse as any\n  },\n  getResponseError(_, response) {\n    let error = new Error('Upload error')\n\n    if (isNetworkError(response)) {\n      error = new NetworkError(error, response)\n    }\n\n    return error\n  },\n  validateStatus(status) {\n    return status >= 200 && status < 300\n  },\n} satisfies Partial<XhrUploadOpts<any, any>>\n\ntype Opts<M extends Meta, B extends Body> = DefinePluginOpts<\n  XhrUploadOpts<M, B>,\n  keyof typeof defaultOptions\n>\n\ninterface OptsWithHeaders<M extends Meta, B extends Body> extends Opts<M, B> {\n  headers: Record<string, string>\n}\n\nexport default class XHRUpload<\n  M extends Meta,\n  B extends Body,\n> extends BasePlugin<Opts<M, B>, M, B> {\n  // eslint-disable-next-line global-require\n  static VERSION = packageJson.version\n\n  #getFetcher\n\n  requests: RateLimitedQueue\n\n  uploaderEvents: Record<string, EventManager<M, B> | null>\n\n  constructor(uppy: Uppy<M, B>, opts: XhrUploadOpts<M, B>) {\n    super(uppy, {\n      ...defaultOptions,\n      fieldName: opts.bundle ? 'files[]' : 'file',\n      ...opts,\n    })\n    this.type = 'uploader'\n    this.id = this.opts.id || 'XHRUpload'\n\n    this.defaultLocale = locale\n\n    this.i18nInit()\n\n    // Simultaneous upload limiting is shared across all uploads with this plugin.\n    if (internalRateLimitedQueue in this.opts) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore untyped internal\n      this.requests = this.opts[internalRateLimitedQueue]\n    } else {\n      this.requests = new RateLimitedQueue(this.opts.limit)\n    }\n\n    if (this.opts.bundle && !this.opts.formData) {\n      throw new Error(\n        '`opts.formData` must be true when `opts.bundle` is enabled.',\n      )\n    }\n\n    if (this.opts.bundle && typeof this.opts.headers === 'function') {\n      throw new Error(\n        '`opts.headers` can not be a function when the `bundle: true` option is set.',\n      )\n    }\n\n    if (opts?.allowedMetaFields === undefined && 'metaFields' in this.opts) {\n      throw new Error(\n        'The `metaFields` option has been renamed to `allowedMetaFields`.',\n      )\n    }\n\n    this.uploaderEvents = Object.create(null)\n    /**\n     * xhr-upload wrapper for `fetcher` to handle user options\n     * `validateStatus`, `getResponseError`, `getResponseData`\n     * and to emit `upload-progress`, `upload-error`, and `upload-success` events.\n     */\n    this.#getFetcher = (files: UppyFile<M, B>[]) => {\n      return async (\n        url: Parameters<typeof fetcher>[0],\n        options: NonNullable<Parameters<typeof fetcher>[1]>,\n      ) => {\n        try {\n          const res = await fetcher(url, {\n            ...options,\n            method: options?.method?.toUpperCase(),\n            onTimeout: (timeout) => {\n              const seconds = Math.ceil(timeout / 1000)\n              const error = new Error(this.i18n('uploadStalled', { seconds }))\n              this.uppy.emit('upload-stalled', error, files)\n            },\n            onUploadProgress: (event) => {\n              if (event.lengthComputable) {\n                for (const file of files) {\n                  this.uppy.emit('upload-progress', file, {\n                    // TODO: do not send `uploader` in next major\n                    // @ts-expect-error we can't type this and we should remove it\n                    uploader: this,\n                    bytesUploaded: (event.loaded / event.total) * file.size!,\n                    bytesTotal: file.size,\n                  })\n                }\n              }\n            },\n          })\n\n          if (!this.opts.validateStatus(res.status, res.responseText, res)) {\n            throw new NetworkError(res.statusText, res)\n          }\n\n          const body = this.opts.getResponseData(res.responseText, res)\n          const uploadURL = body?.[this.opts.responseUrlFieldName] as\n            | string\n            | undefined\n\n          for (const file of files) {\n            this.uppy.emit('upload-success', file, {\n              status: res.status,\n              body,\n              uploadURL,\n            })\n          }\n\n          return res\n        } catch (error) {\n          if (error.name === 'AbortError') {\n            return undefined\n          }\n          if (error instanceof NetworkError) {\n            const request = error.request!\n            const customError = buildResponseError(\n              request,\n              this.opts.getResponseError(request.responseText, request),\n            )\n            for (const file of files) {\n              this.uppy.emit('upload-error', file, customError)\n            }\n          }\n\n          throw error\n        }\n      }\n    }\n  }\n\n  getOptions(file: UppyFile<M, B>): OptsWithHeaders<M, B> {\n    const overrides = this.uppy.getState().xhrUpload\n    const { headers } = this.opts\n\n    const opts = {\n      ...this.opts,\n      ...(overrides || {}),\n      ...(file.xhrUpload || {}),\n      headers: {},\n    }\n    // Support for `headers` as a function, only in the XHRUpload settings.\n    // Options set by other plugins in Uppy state or on the files themselves are still merged in afterward.\n    //\n    // ```js\n    // headers: (file) => ({ expires: file.meta.expires })\n    // ```\n    if (typeof headers === 'function') {\n      opts.headers = headers(file)\n    } else {\n      Object.assign(opts.headers, this.opts.headers)\n    }\n\n    if (overrides) {\n      Object.assign(opts.headers, overrides.headers)\n    }\n    if (file.xhrUpload) {\n      Object.assign(opts.headers, file.xhrUpload.headers)\n    }\n\n    return opts\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addMetadata(\n    formData: FormData,\n    meta: State<M, B>['meta'],\n    opts: Opts<M, B>,\n  ): void {\n    const allowedMetaFields =\n      Array.isArray(opts.allowedMetaFields) ?\n        opts.allowedMetaFields\n      : Object.keys(meta) // Send along all fields by default.\n\n    allowedMetaFields.forEach((item) => {\n      const value = meta[item]\n      if (Array.isArray(value)) {\n        // In this case we don't transform `item` to add brackets, it's up to\n        // the user to add the brackets so it won't be overridden.\n        value.forEach((subItem) => formData.append(item, subItem))\n      } else {\n        formData.append(item, value as string)\n      }\n    })\n  }\n\n  createFormDataUpload(file: UppyFile<M, B>, opts: Opts<M, B>): FormData {\n    const formPost = new FormData()\n\n    this.addMetadata(formPost, file.meta, opts)\n\n    const dataWithUpdatedType = setTypeInBlob(file)\n\n    if (file.name) {\n      formPost.append(opts.fieldName, dataWithUpdatedType, file.meta.name)\n    } else {\n      formPost.append(opts.fieldName, dataWithUpdatedType)\n    }\n\n    return formPost\n  }\n\n  createBundledUpload(files: UppyFile<M, B>[], opts: Opts<M, B>): FormData {\n    const formPost = new FormData()\n\n    const { meta } = this.uppy.getState()\n    this.addMetadata(formPost, meta, opts)\n\n    files.forEach((file) => {\n      const options = this.getOptions(file)\n\n      const dataWithUpdatedType = setTypeInBlob(file)\n\n      if (file.name) {\n        formPost.append(options.fieldName, dataWithUpdatedType, file.name)\n      } else {\n        formPost.append(options.fieldName, dataWithUpdatedType)\n      }\n    })\n\n    return formPost\n  }\n\n  async #uploadLocalFile(file: UppyFile<M, B>) {\n    const events = new EventManager(this.uppy)\n    const controller = new AbortController()\n    const uppyFetch = this.requests.wrapPromiseFunction(async () => {\n      const opts = this.getOptions(file)\n      const fetch = this.#getFetcher([file])\n      const body =\n        opts.formData ? this.createFormDataUpload(file, opts) : file.data\n      return fetch(opts.endpoint, {\n        ...opts,\n        body,\n        signal: controller.signal,\n      })\n    })\n\n    events.onFileRemove(file.id, () => controller.abort())\n    events.onCancelAll(file.id, ({ reason }) => {\n      if (reason === 'user') {\n        controller.abort()\n      }\n    })\n\n    try {\n      await uppyFetch().abortOn(controller.signal)\n    } catch (error) {\n      // TODO: create formal error with name 'AbortError' (this comes from RateLimitedQueue)\n      if (error.message !== 'Cancelled') {\n        throw error\n      }\n    } finally {\n      events.remove()\n    }\n  }\n\n  async #uploadBundle(files: UppyFile<M, B>[]) {\n    const controller = new AbortController()\n    const uppyFetch = this.requests.wrapPromiseFunction(async () => {\n      const optsFromState = this.uppy.getState().xhrUpload ?? {}\n      const fetch = this.#getFetcher(files)\n      const body = this.createBundledUpload(files, {\n        ...this.opts,\n        ...optsFromState,\n      })\n      return fetch(this.opts.endpoint, {\n        // headers can't be a function with bundle: true\n        ...(this.opts as OptsWithHeaders<M, B>),\n        body,\n        signal: controller.signal,\n      })\n    })\n\n    function abort() {\n      controller.abort()\n    }\n\n    // We only need to abort on cancel all because\n    // individual cancellations are not possible with bundle: true\n    this.uppy.once('cancel-all', abort)\n\n    try {\n      await uppyFetch().abortOn(controller.signal)\n    } catch (error) {\n      // TODO: create formal error with name 'AbortError' (this comes from RateLimitedQueue)\n      if (error.message !== 'Cancelled') {\n        throw error\n      }\n    } finally {\n      this.uppy.off('cancel-all', abort)\n    }\n  }\n\n  #getCompanionClientArgs(file: UppyFile<M, B>) {\n    const opts = this.getOptions(file)\n    const allowedMetaFields =\n      Array.isArray(opts.allowedMetaFields) ?\n        opts.allowedMetaFields\n        // Send along all fields by default.\n      : Object.keys(file.meta)\n    return {\n      ...file.remote?.body,\n      protocol: 'multipart',\n      endpoint: opts.endpoint,\n      size: file.data.size,\n      fieldname: opts.fieldName,\n      metadata: Object.fromEntries(\n        allowedMetaFields.map((name) => [name, file.meta[name]]),\n      ),\n      httpMethod: opts.method,\n      useFormData: opts.formData,\n      headers: opts.headers,\n    }\n  }\n\n  async #uploadFiles(files: UppyFile<M, B>[]) {\n    await Promise.allSettled(\n      files.map((file) => {\n        if (file.isRemote) {\n          const getQueue = () => this.requests\n          const controller = new AbortController()\n\n          const removedHandler = (removedFile: UppyFile<M, B>) => {\n            if (removedFile.id === file.id) controller.abort()\n          }\n          this.uppy.on('file-removed', removedHandler)\n\n          const uploadPromise = this.uppy\n            .getRequestClientForFile<RequestClient<M, B>>(file)\n            .uploadRemoteFile(file, this.#getCompanionClientArgs(file), {\n              signal: controller.signal,\n              getQueue,\n            })\n\n          this.requests.wrapSyncFunction(\n            () => {\n              this.uppy.off('file-removed', removedHandler)\n            },\n            { priority: -1 },\n          )()\n\n          return uploadPromise\n        }\n\n        return this.#uploadLocalFile(file)\n      }),\n    )\n  }\n\n  #handleUpload = async (fileIDs: string[]) => {\n    if (fileIDs.length === 0) {\n      this.uppy.log('[XHRUpload] No files to upload!')\n      return\n    }\n\n    // No limit configured by the user, and no RateLimitedQueue passed in by a \"parent\" plugin\n    // (basically just AwsS3) using the internal symbol\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore untyped internal\n    if (this.opts.limit === 0 && !this.opts[internalRateLimitedQueue]) {\n      this.uppy.log(\n        '[XHRUpload] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/xhr-upload/#limit-0',\n        'warning',\n      )\n    }\n\n    this.uppy.log('[XHRUpload] Uploading...')\n    const files = this.uppy.getFilesByIds(fileIDs)\n\n    const filesFiltered = filterNonFailedFiles(files)\n    const filesToEmit = filterFilesToEmitUploadStarted(filesFiltered)\n    this.uppy.emit('upload-start', filesToEmit)\n\n    if (this.opts.bundle) {\n      // if bundle: true, we don’t support remote uploads\n      const isSomeFileRemote = filesFiltered.some((file) => file.isRemote)\n      if (isSomeFileRemote) {\n        throw new Error(\n          'Can’t upload remote files when the `bundle: true` option is set',\n        )\n      }\n\n      if (typeof this.opts.headers === 'function') {\n        throw new TypeError(\n          '`headers` may not be a function when the `bundle: true` option is set',\n        )\n      }\n\n      await this.#uploadBundle(filesFiltered)\n    } else {\n      await this.#uploadFiles(filesFiltered)\n    }\n  }\n\n  install(): void {\n    if (this.opts.bundle) {\n      const { capabilities } = this.uppy.getState()\n      this.uppy.setState({\n        capabilities: {\n          ...capabilities,\n          individualCancellation: false,\n        },\n      })\n    }\n\n    this.uppy.addUploader(this.#handleUpload)\n  }\n\n  uninstall(): void {\n    if (this.opts.bundle) {\n      const { capabilities } = this.uppy.getState()\n      this.uppy.setState({\n        capabilities: {\n          ...capabilities,\n          individualCancellation: true,\n        },\n      })\n    }\n\n    this.uppy.removeUploader(this.#handleUpload)\n  }\n}\n"],"mappings":"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"}